---
title: "Lab Results Report"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    theme: paper
    highlight: tango
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
      side: left
    toc_depth: 3
    number_sections: false
  word_document:
    toc: true
    toc_depth: '3'
---

```{css, echo = FALSE}
h3 {
  text-align: center;
  font-weight: bold;
}
```

```{r setup, echo = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<h3 style="text-align:center; font-weight:bold;">Visit Summaries</h3>
<br>

Participant and visit summary information for a particular case report form (CRF) can be included in these reports. Simply customize the code blocks to include report-relevant information. Examples are provided.

<h4 style="text-align:center;">Visit Counts by Participant</h4>

See how many visits have been completed for all participants, including those who failed screening.

Lengthy table outputs can be converted to an optional dropdown menu.

```{r CountSummary, echo = FALSE}
# enable toggle dropdown output
asis_output("
<details>
<summary>Show Table</summary>
")

edc %>%
  group_by(pid) %>%
  summarise(
    `Visit Count` = n()
    #`Percent` = round(100 * n() / nrow(edc), 1)
  ) %>%
  rename(
    `Participant ID` = pid
  ) %>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE, position = "center")

# enable toggle dropdown output
asis_output("</details>")
```

<h4 style="text-align:center;">Cumulative Visit Counts</h4>

```{r EventSummary, echo = FALSE}
edc %>%
  group_by(visit_type) %>%
  summarise(
    Count = n(),
    Percent = round(100 * n() / nrow(edc), 1)
  ) %>%
  rename(Visit = visit_type) %>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE, position = "center")
```

<h4 style="text-align:center;">Baseline Lab Results Completion</h4>

```{r BaselineLabs, echo = FALSE}
edc_v1 %>%
  summarise(
    Complete = sum(baseline_labresults_inst_complete == 1),
    Incomplete = sum(baseline_labresults_inst_complete == 0)
  ) %>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE, position = "center")
```

<h3 style="text-align:center; font-weight:bold;">Baseline Lab Results</h3>
<br>

<h4 style="text-align:center;">Lab Result Flags</h4>

```{r FlagResults, echo = FALSE}
outrange %>%
  select(pid, contains("_flag")) %>%
  rename(
    `Participant ID` = pid
  ) %>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE, position = "center")
```

<h4 style="text-align:center;">Lab Result Test Names</h4>

```{r, echo = FALSE}
outrange_testnames %>%
  rename(
    `Participant ID` = pid,
    `Out of Range (Low)` = OutOfRangeLow,
    `Out of Range (High)` = OutOfRangeHigh,
    `In Range` = InRange,
    `Invalid Range` = Invalid
  ) %>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE, position = "center")
```
